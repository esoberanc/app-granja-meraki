
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Granja de Tenebrio - Sensores</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: #f9fafb;
      font-family: Arial, sans-serif;
    }
    h1 {
      text-align: center;
      padding: 10px;
      background-color: #0f172a;
      color: white;
    }
    #dashboard {
      position: relative;
      width: 800px;
      margin: 20px auto;
    }
    #dashboard img {
      width: 100%;
      border-radius: 12px;
    }
    .cuadro {
      position: absolute;
      width: 120px;
      height: 50px;
      border-radius: 10px;
      color: white;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: gray;
    }

    /* Posiciones solo para ejemplo r√°pido */
    #sensor1 { top: 30px; left: 80px; }
    #sensor2 { top: 100px; left: 80px; }
    #sensor1_humidity { top: 170px; left: 80px; }
    #sensor2_humidity { top: 240px; left: 80px; }
    #multi1_temp { top: 30px; left: 550px; }
    #multi1_co2 { top: 100px; left: 550px; }
    #multi1_pm25 { top: 170px; left: 550px; }
    #multi1_noise { top: 240px; left: 550px; }
    #power1 { top: 320px; left: 80px; }
    #power2 { top: 320px; left: 550px; }
    #powerFactor1 { top: 390px; left: 80px; }
    #powerFactor2 { top: 390px; left: 550px; }
    #puerta1 { top: 460px; left: 320px; }
  </style>
</head>
<body>
  <h1>üì° Dashboard de Sensores - Granja Tenebrio</h1>
  <div id="dashboard">
    <img src="/static/Granja.png" alt="Granja" />
    <div id="sensor1" class="cuadro">--</div>
    <div id="sensor2" class="cuadro">--</div>
    <div id="sensor1_humidity" class="cuadro">--</div>
    <div id="sensor2_humidity" class="cuadro">--</div>
    <div id="multi1_temp" class="cuadro">--</div>
    <div id="multi1_co2" class="cuadro">--</div>
    <div id="multi1_pm25" class="cuadro">--</div>
    <div id="multi1_noise" class="cuadro">--</div>
    <div id="power1" class="cuadro">--</div>
    <div id="power2" class="cuadro">--</div>
    <div id="powerFactor1" class="cuadro">--</div>
    <div id="powerFactor2" class="cuadro">--</div>
    <div id="puerta1" class="cuadro">--</div>
  </div>

  <script>
    async function cargarDatos() {
      try {
        const res = await fetch("/sensor-data");
        const data = await res.json();
        console.log("üì¶ Datos recibidos:", data);

        for (const key in data) {
          const el = document.getElementById(key);
          if (el) {
            const valor = data[key];
            if (key.includes("humidity")) {
              el.textContent = valor + " %";
              el.style.backgroundColor = valor < 50 || valor > 70 ? "#b91c1c" : "#15803d";
            } else if (key.includes("temp")) {
              el.textContent = valor.toFixed(1) + " ¬∞C";
              el.style.backgroundColor = valor < 22 || valor > 30 ? "#b91c1c" : "#15803d";
            } else if (key.includes("co2")) {
              el.textContent = valor + " ppm";
              el.style.backgroundColor = valor > 800 ? "#b91c1c" : "#15803d";
            } else if (key.includes("pm25")) {
              el.textContent = valor + " ¬µg/m¬≥";
              el.style.backgroundColor = valor > 70 ? "#b91c1c" : (valor > 40 ? "#ca8a04" : "#15803d");
            } else if (key.includes("noise")) {
              el.textContent = valor + " dB";
              el.style.backgroundColor = valor > 50 ? "#b91c1c" : "#15803d";
            } else if (key.includes("powerFactor")) {
              el.textContent = valor + " %";
              el.style.backgroundColor = "#0e7490";
            } else if (key.includes("power")) {
              el.textContent = valor + " W";
              el.style.backgroundColor = "#0e7490";
            } else if (key === "puerta1") {
              el.textContent = valor === "open" ? "üö™ Abierta" : "‚úÖ Cerrada";
              el.style.backgroundColor = valor === "open" ? "#b91c1c" : "#15803d";
            } else {
              el.textContent = valor;
              el.style.backgroundColor = "#15803d";
            }
          }
        }
      } catch (err) {
        console.error("‚ùå Error al obtener datos:", err);
      }
    }

    setInterval(cargarDatos, 5000);
    window.onload = cargarDatos;
  </script>
</body>
</html>
