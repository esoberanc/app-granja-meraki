
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Monitoreo de Granja Tenebrio</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-center font-sans p-4">
    <h1 class="text-3xl font-bold mb-4">📡 Monitoreo de Granja Tenebrio</h1>

    <button id="toggleBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded mb-2">
        🛑 Detener monitoreo
    </button>
    <div id="estado" class="text-green-600 font-semibold mb-4">🟢 Monitoreo activo</div>

    <img src="/static/Granja.png" alt="Granja" class="mx-auto mb-4 max-w-full h-auto"/>

    <script>
        let monitoreoActivo = true;
        let intervalo;

        function getSensorData(guardar = false) {
            const url = guardar ? "/sensor-data?guardar=true" : "/sensor-data";
            fetch(url)
                .then((res) => res.json())
                .then((data) => console.log("Datos recibidos:", data))
                .catch((err) => console.error("Error al obtener datos:", err));
        }

        function actualizarBoton() {
            const boton = document.getElementById("toggleBtn");
            const estado = document.getElementById("estado");
            if (monitoreoActivo) {
                boton.textContent = "🛑 Detener monitoreo";
                boton.className = "bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded mb-2";
                estado.textContent = "🟢 Monitoreo activo";
                estado.className = "text-green-600 font-semibold mb-4";
            } else {
                boton.textContent = "▶️ Iniciar monitoreo";
                boton.className = "bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mb-2";
                estado.textContent = "🔴 Monitoreo detenido";
                estado.className = "text-red-600 font-semibold mb-4";
            }
        }

        document.getElementById("toggleBtn").addEventListener("click", () => {
            monitoreoActivo = !monitoreoActivo;
            actualizarBoton();
            if (monitoreoActivo) {
                getSensorData(true);
                intervalo = setInterval(() => getSensorData(true), 10000);
            } else {
                clearInterval(intervalo);
            }
        });

        window.onload = () => {
            monitoreoActivo = true;
            actualizarBoton();
            getSensorData(true);
            intervalo = setInterval(() => getSensorData(true), 10000);
        };
    </script>
</body>
</html>
